# AntibioticShortageProject

## Contents

- [Overview](#overview)
- [Repo Contents](#repo-contents)
- [System Requirements](#system-requirements)
- [Installation Guide](#installation-guide)
- [Demo](#demo)
- [Instruction for use](#instruction-for-use)


# Overview

Antibiotic shortages have become frequent worldwide, with potential consequences on bacterial ecology that are not fully understood. Here, we use mathematical modelling to investigate the impact of amoxicillin shortage on pneumococcal resistance and invasive pneumococcal disease (IPD) incidence.

# Repo Contents

- [Script](./Script): R code to generate all the analyses in the manuscript and supplementary
- [Files](./Files): File used in analyses, generated by R codes in Script
- [Figures](./Figures): Figures in the manuscript and supplementary

# System Requirements

## Hardware Requirements

The code has been tested with a computer with the following specs:

RAM: 64 GB  
CPU: 12-cores, 4.10 GHz

## Software Requirements

### OS Requirements

The code has been tested on the following systems:

Windows 11 Professionnel

#### Installing R version 4.3.3 

# Installation Guide


Users should install the following packages, from an `R` terminal:

```
install.packages(c("ggplot2", "readxl", "tidyr", "dplyr", "reshape2", "ggpubr", "socialmixr", "RColorBrewer", "rmarkdown", "plotly", "demodelr", "forcats", "sf", "corrplot", "gridExtra", "gridGraphics","patchwork", "refset",
 "cowplot", "odin","ggh4x", "here", "lhs", "sensitivity", "ggflags", "lemon", "ggthemes", "khroma"))
```

which will install in about 2 minutes on a machine with the recommended specs.

# Demo and instructions for use

## Script description

#### Core Model Files
- [DeuxAgeHuitResistanceDeuxAntibiosOdin.R](./Script/DeuxAgeHuitResistanceDeuxAntibiosOdin.R): Odin equations to generate all the simulations
- [DeuxAgeDeuxResistanceOdin.R](./DeuxAgeDeuxResistanceOdin.R): Odin equations to generate all the simulations

#### Parameter Calibration
- [EstimationOfAntibioticEfficacy.Rmd](./Script/EstimationOfAntibioticEfficacy.Rmd):  R code to calibrate antibiotic-induced decolonization rates (Figure S10 and S11)
- [ParametersEstimation.Rmd](./Script/ParametersEstimation.Rmd): R code to calibrate transmission parameters

#### Main Figures
- [Figure1_ScenariosPresentation.Rmd](./Script/Figure1_ScenariosPresentation.Rmd): R code to simulate the impact of different shortage management strategies on the evolution of antibiotic exposure and pneumococcal resistance (Figure 2 and Figure S1)
- [Figure2and3_RunDifferentShortageLevels.Rmd](./Script/Figure2and3_RunDifferentShortageLevels.Rmd): R code to simulate the relative variation of different shortage levels (Figure 3) and a 1-year impact of a 50% beta-lactam shortage (Figure 4 and Figure S2)
- [Figure4_BestScenarioAccordingMainParameters.Rmd](./Script/Figure4_BestScenarioAccordingMainParameters.Rmd): R code to generate dataframeVariationPNSP_MR_GammaAmox.csv, dataframeVariationPNSP_MR_Lambda.csv, dataframeVariationPNSP_MR_Rcr.csv, and dataframeVariationPNSP_MR_pi.csv and to simulate the recommended antibiotic shortage management strategy depending on the initial conditions (Figure 5 and Figure S4)
- [Figure5_BestScenariosbyCountry.Rmd](./Script/Figure5_BestScenariosbyCountry.Rmd): R code to simulate shortage in 20 European countries (Figure 6, Figure S9) and to construct the correlation matrix between initial conditions on country-specific pharmaco-epidemiological context (Figure S8) and to genrate the plot of tha association between antibiotic consumption frequency and associated resistance across 20 European countries (Figure S13)

#### Sensitivity and Uncertainty Analyses
- [PRCCAnlaysis_ResistanceDistribution.Rmd](./Script/PRCCAnlaysis_ResistanceDistribution.Rmd) : R code to simulate multivariate sensitivity analysis (Figure S3)
- [SensitivtyAnalysis_DifferentMICDistributions.Rmd](./Script/SensitivtyAnalysis_DifferentMICDistributions.Rmd):  R code to simulate sensitivity analysis for different MIC distributions (Figure S5)
- [SensitivityAnalysis_Theta.Rmd](./Script/SensitivityAnalysis_Theta.Rmd): R code to simulate a sensitivity analysis of competition parameter (Figure S6)
- [AnalysesUncertaintyFitness.Rmd](./Script/AnalysesUncertaintyFitness.Rmd): R code to simulate uncertainty analysis for fitness (Figure S7)
- [UncertaintyAnalysis0to100LevelsOfShortage.R](./Script/UncertaintyAnalysis0to100LevelsOfShortage.R): R code to generate fichierCombine070225_0to100.csv
- [UncertaintyAnalysisFigure1.R](./Script/UncertaintyAnalysisFigure1.R): R code to generate fichierCombine070225_figure1.csv
- [UncertaintyAnalysisMinMaxMean.R](./Script/UncertaintyAnalysisMinMaxMean.R): R code to generate fichierCombine070225MaxMinMean.csv

#### Supporting Files
- [SigmoidReductionFunction.R](./Script/SigmoidReductionFunction.R): Plots amoxicillin treatment-induced decolonization rate for different shortage levels (Figure S10)


## Execution Order :

### Step 1 : Parameter Calibration 

1. Run [EstimationOfAntibioticEfficacy.Rmd](./Script/EstimationOfAntibioticEfficacy.Rmd) to obtain antibiotic-induced decolonization rates
2. Run [ParametersEstimation.Rmd](./Script/ParametersEstimation.Rmd) to obtain transmissibility parameters

### Step 2: Main Figures :

**For Figure 2 and Figure S1:**
1. Run [UncertaintyAnalysisFigure1.R](./Script/UncertaintyAnalysisFigure1.R) to generate [fichierCombine070225_figure1.csv](./Files/fichierCombine070225_figure1.csv) *(takes several tens of minutes)*
2. Run [Figure1_ScenariosPresentation.Rmd](./Script/Figure1_ScenariosPresentation.Rmd)

**For Figures 3-4 and Figure S2:**
1. Run [UncertaintyAnalysis0to100LevelsOfShortage.R](./Script/UncertaintyAnalysis0to100LevelsOfShortage.R) and [UncertaintyAnalysisMinMaxMean.R](./Script/UncertaintyAnalysisMinMaxMean.R) to generate data files *(takes several tens of minutes)*
2. Run [Figure2and3_RunDifferentShortageLevels.Rmd](./Script/Figure2and3_RunDifferentShortageLevels.Rmd)

**For Figure 5 and Figure S4:**
- Run [Figure4_BestScenarioAccordingMainParameters.Rmd](./Script/Figure4_BestScenarioAccordingMainParameters.Rmd) (generates required CSV files and figures)

**For Figure 6 and Figures S8-S9, S13:**
- Run [Figure5_BestScenariosbyCountry.Rmd](./Script/Figure5_BestScenariosbyCountry.Rmd)

### Step 3: Supplementary Figures :

- **Figure S3**: Run [PRCCAnlaysis_ResistanceDistribution.Rmd](./Script/PRCCAnlaysis_ResistanceDistribution.Rmd) *(~12 hours)*
- **Figure S5**: Run [SensitivtyAnalysis_DifferentMICDistributions.Rmd](./Script/SensitivtyAnalysis_DifferentMICDistributions.Rmd) *(several tens of minutes)*
- **Figure S6**: Run [SensitivityAnalysis_Theta.Rmd](./Script/SensitivityAnalysis_Theta.Rmd)
- **Figure S7**: Run [AnalysesUncertaintyFitness.Rmd](./Script/AnalysesUncertaintyFitness.Rmd)
- **Figure S12**: Run [SigmoidReductionFunction.R](./Script/SigmoidReductionFunction.R)


Most scripts run in a few minutes with recommended specs, except where noted otherwise




